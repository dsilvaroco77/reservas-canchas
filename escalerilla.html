<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Favicon y manifest, igual que index -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="logo_uctenis_v03.png" type="image/png">
    <link rel="manifest" href="manifest.json">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escalerilla · UCTenis</title>
    <meta name="theme-color" content="#001f33"/>

    <style>
        :root{
            --background-color:#001f33;   /* mismo override de index (azul medianoche) */
            --text-color:#f5f5f7;
            --subtle-text-color:#cdd1d4;
            --accent-color:#c6d300;       /* acento verde/amarillo de tu index */
            --card-background:rgba(255,255,255,0.08);
            --border-soft:rgba(255,255,255,0.1);
        }
        @keyframes fadeIn {from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
        *{box-sizing:border-box}
        body{
            margin:0; background:var(--background-color); color:var(--text-color);
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
        }
        .main-container{max-width:1200px;margin:0 auto;padding:40px 20px;animation:fadeIn .8s ease-out forwards}
        header{text-align:center;margin-bottom:30px}
        .club-logo{width:140px;height:auto;display:block;margin:0 auto 10px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.35))}
        h1{font-size:40px;letter-spacing:-.5px;margin:0}
        .subhead{color:var(--subtle-text-color);margin-top:6px}

        /* Tabs */
        .tabs{display:flex;gap:8px;justify-content:center;margin:24px 0 30px;border-bottom:1px solid var(--border-soft)}
        .tab-btn{
            appearance:none;background:none;border:none;color:var(--subtle-text-color);
            padding:12px 16px;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;
        }
        .tab-btn:hover{color:#fff}
        .tab-btn.tab-active{color:var(--accent-color);border-bottom-color:var(--accent-color)}
        .hidden{display:none}

        /* Layout tarjetas */
        .grid{display:grid;grid-template-columns:1fr;gap:20px}
        @media(min-width:900px){ .grid{grid-template-columns:320px 1fr} }

        .card{
            background:var(--card-background); border:1px solid var(--border-soft);
            border-radius:20px; padding:22px;
        }
        .card h2,.card h3{margin:0 0 12px}
        .muted{color:var(--subtle-text-color)}
        .kpi{font-size:26px;font-weight:800}
        .kpi.ok{color:#7be07b}
        .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
        .pill.green{background:rgba(0,255,0,.12);color:#86e986}
        .pill.red{background:rgba(255,0,0,.12);color:#ff9a9a}
        .pill.yellow{background:rgba(255,216,0,.14);color:#ffe066}

        /* Botones */
        .btn{appearance:none;border:none;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:700}
        .btn:disabled{opacity:.45;cursor:not-allowed}
        .btn-primary{background:var(--accent-color);color:#111}
        .btn-primary:hover{filter:brightness(1.05)}
        .btn-blue{background:#2ea0ff;color:#fff}
        .btn-blue:hover{filter:brightness(1.1)}
        .btn-green{background:#21c07a;color:#072}
        .btn-green:hover{filter:brightness(1.05)}
        .btn-ghost{background:transparent;color:var(--subtle-text-color);border:1px solid var(--border-soft)}
        .btn-ghost:hover{color:#fff}

        /* Tabla */
        .table-wrap{overflow:auto}
        table{width:100%;border-collapse:collapse}
        th,td{padding:12px 14px;border-bottom:1px solid var(--border-soft);text-align:left}
        thead th{color:var(--accent-color);font-weight:700}
        tbody tr:hover{background:rgba(255,255,255,0.05)}
        .actions a,.actions button{margin-right:10px}

        /* Sub-tabs ranking */
        .subtabs{display:flex;gap:6px;background:rgba(255,255,255,0.06);border:1px solid var(--border-soft);border-radius:12px;padding:6px;width:max-content}
        .subtab{padding:8px 14px;border-radius:8px;cursor:pointer;color:var(--subtle-text-color);font-weight:700}
        .subtab:hover{color:#fff}
        .sub-tab-active{background:var(--accent-color);color:#111}

        /* Rank arrows */
        .rank-btn{background:transparent;border:1px solid var(--border-soft);border-radius:10px;padding:6px 10px;color:var(--subtle-text-color);cursor:pointer}
        .rank-btn:hover{color:#fff;border-color:var(--accent-color)}
        .rank-btn:disabled{opacity:.35}

        /* Modales */
        .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
        .modal-backdrop.show{display:flex}
        .modal{background:#0f2536;border:1px solid var(--border-soft);border-radius:16px;padding:22px;width:min(92vw,520px);max-height:90vh;overflow:auto}
        .modal h2{margin-top:0}
        .form-grid{display:grid;grid-template-columns:1fr;gap:12px}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        label{font-size:13px;color:var(--subtle-text-color)}
        input,select,textarea{
            width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border-soft);
            background:rgba(255,255,255,0.06);color:var(--text-color)
        }
        textarea{resize:vertical}
        .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}

        /* Footer */
        footer{text-align:center;margin-top:30px;color:var(--subtle-text-color)}
        .footer-links{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin:14px 0 8px}
        .footer-links a{
            color:var(--subtle-text-color); text-decoration:none; padding:10px 16px;
            border:1px solid var(--border-soft); border-radius:18px; background:var(--card-background);
        }
        .footer-links a:hover{background:var(--accent-color);color:#111;border-color:var(--accent-color)}
        .brand-legend{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:12px}
        .brand-legend img{width:42px;height:auto;filter:drop-shadow(0 1px 3px rgba(0,0,0,.3))}
    </style>
</head>
<body>
    <div class="main-container">
        <header>
            <img src="logo_uctenis_v03.png" alt="Logo UCTenis" class="club-logo">
            <h1>Escalerilla UCTenis</h1>
            <div class="subhead">Miembros, ranking y libro de desafíos</div>
        </header>

        <!-- Navegación de secciones -->
        <nav class="tabs" aria-label="Secciones">
            <button id="tab-miembros" class="tab-btn tab-active">Gestión de Miembros</button>
            <button id="tab-ranking" class="tab-btn">Ranking</button>
            <button id="tab-desafios" class="tab-btn">Libro de Desafíos</button>
        </nav>

        <main>
            <!-- Gestión de Miembros -->
            <section id="content-miembros">
                <div class="grid">
                    <!-- Resumen -->
                    <aside class="card">
                        <h3>Resumen del Club</h3>
                        <div class="muted">Total de Miembros</div>
                        <div id="total-miembros" class="kpi">0</div>
                        <div class="muted" style="margin-top:10px">Miembros Activos</div>
                        <div id="miembros-activos" class="kpi ok">0</div>
                        <div class="muted" style="margin-top:10px">División Masculina</div>
                        <div id="division-masculino" class="kpi">0</div>
                        <div class="muted" style="margin-top:10px">División Femenina</div>
                        <div id="division-femenino" class="kpi">0</div>
                    </aside>

                    <!-- Tabla -->
                    <section class="card">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                            <h2>Lista de Miembros</h2>
                            <div style="display:flex;gap:8px">
                                <button id="bulk-upload-btn" class="btn btn-green">Carga Masiva (CSV)</button>
                                <button id="add-member-btn" class="btn btn-blue">Agregar Miembro</button>
                            </div>
                        </div>
                        <div class="table-wrap">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nombre Completo</th>
                                        <th>RUT</th>
                                        <th>Categoría</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="members-table-body"></tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </section>

            <!-- Ranking -->
            <section id="content-ranking" class="hidden">
                <div class="card">
                    <h2 style="margin-bottom:10px">Ranking de Jugadores Activos</h2>

                    <div class="subtabs" style="margin-bottom:12px">
                        <button id="sub-tab-masculino" class="subtab sub-tab-active">Masculino</button>
                        <button id="sub-tab-femenino" class="subtab">Femenino</button>
                    </div>

                    <!-- Masculino -->
                    <div id="ranking-content-masculino">
                        <div class="table-wrap">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Posición</th>
                                        <th>Jugador</th>
                                        <th>Categoría</th>
                                        <th>Ajustar</th>
                                    </tr>
                                </thead>
                                <tbody id="ranking-table-body-masculino"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Femenino -->
                    <div id="ranking-content-femenino" class="hidden">
                        <div class="table-wrap">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Posición</th>
                                        <th>Jugador</th>
                                        <th>Categoría</th>
                                        <th>Ajustar</th>
                                    </tr>
                                </thead>
                                <tbody id="ranking-table-body-femenino"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Libro de Desafíos -->
            <section id="content-desafios" class="hidden">
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h2>Libro de Desafíos</h2>
                        <button id="add-challenge-btn" class="btn btn-green">Nuevo Desafío</button>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha y Hora</th>
                                    <th>Partido</th>
                                    <th>Resultado</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="challenges-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <div class="footer-links">
                <a href="index.html">Reservar Canchas</a>
                <a href="ranking.html">Ver Ranking Público</a>
                <a href="normas.html">Normas de Uso</a>
            </div>
            <div class="brand-legend">
                <img src="logo_uctenis_v03.png" alt="Escudo UCTenis">
                <span>UCTenis Club · Universidad Católica de Temuco</span>
            </div>
        </footer>
    </div>

    <!-- Input oculto para CSV -->
    <input type="file" id="csv-file-input" class="hidden" accept=".csv" style="display:none">

    <!-- Modales -->
    <div id="member-modal" class="modal-backdrop">
        <div class="modal">
            <h2 id="member-modal-title">Agregar Miembro</h2>
            <form id="member-form">
                <input type="hidden" id="member-id">
                <div class="form-row">
                    <div>
                        <label for="nombres">Nombres</label>
                        <input type="text" id="nombres" required>
                    </div>
                    <div>
