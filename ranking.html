<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ranking de Jugadores - UCTenis</title>
<meta name="theme-color" content="#001f33"/>

<style>
:root{
  --background-color:#001f33; /* Azul medianoche */
  --text-color:#f5f5f7;
  --subtle-text-color:#a1a1a6;
  --accent-color:#c6d300;     /* Verde UCTenis */
  --card-background:rgba(255,255,255,0.05);
}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0;background:var(--background-color);color:var(--text-color)}
.main-container{max-width:900px;margin:0 auto;padding:40px 20px;animation:fadeIn 1s ease-out forwards}
.header-section{text-align:center;margin-bottom:20px}
.uct-logo{width:clamp(96px,14vw,168px);height:auto;display:block;margin:0 auto 12px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.35))}
h1{font-size:36px;font-weight:700;letter-spacing:-1px;margin:0}
.ranking-info{text-align:center;margin-bottom:20px}
.last-updated-date{font-size:14px;color:var(--subtle-text-color);font-style:italic}

/* Secciones */
.section{background:var(--card-background);border-radius:18px;padding:18px 16px;margin-bottom:24px;border:1px solid rgba(255,255,255,.1)}
.section h2{font-size:22px;font-weight:700;margin:6px 6px 12px;color:var(--accent-color)}

/* Tablas */
table{width:100%;border-collapse:collapse;color:var(--text-color);display:none}
th,td{padding:12px 15px;text-align:left;border-bottom:1px solid rgba(255,255,255,.1)}
th{font-weight:600;color:var(--accent-color)}
tr:last-child td{border-bottom:none}
tr:hover{background:rgba(255,255,255,.05)}
th:first-child,td:first-child{width:110px;text-align:center}

.loading{color:var(--subtle-text-color);font-style:italic;text-align:center;padding:10px}
.note{font-size:12px;color:var(--subtle-text-color);text-align:center;margin-top:6px;word-break:break-all}

/* Footer */
.footer-nav{text-align:center;margin-top:28px}
.back-button{display:inline-block;background:var(--accent-color);color:#001f33;font-size:16px;font-weight:700;padding:12px 30px;border:none;border-radius:30px;cursor:pointer;text-decoration:none;transition:background-color .2s ease,transform .15s ease}
.back-button:hover{background-color:#a4b200;transform:translateY(-2px)}

@media (max-width:768px){
  h1{font-size:28px}
  th,td{padding:10px;font-size:14px}
  th:first-child,td:first-child{width:80px}
  .section h2{font-size:20px}
}
</style>
</head>
<body>
<div class="main-container">
  <div class="header-section">
    <img src="logo_uctenis_v03.png" alt="Logo UCTenis Club" class="uct-logo" loading="lazy"/>
    <h1>Ranking UCTenis</h1>
  </div>

  <div class="ranking-info">
    <p class="last-updated-date" id="lastUpdatedDate">Cargando fecha…</p>
  </div>

  <!-- MUJERES PRIMERO -->
  <section class="section" id="secM">
    <h2>Ranking Mujeres</h2>
    <div class="loading" id="loadingM">Cargando ranking…</div>
    <table id="tableM">
      <thead><tr><th>Posición</th><th>Nombre</th></tr></thead>
      <tbody id="tbodyM"></tbody>
    </table>
    <div class="note" id="noteM"></div>
  </section>

  <!-- VARONES -->
  <section class="section" id="secH">
    <h2>Ranking Varones</h2>
    <div class="loading" id="loadingH">Cargando ranking…</div>
    <table id="tableH">
      <thead><tr><th>Posición</th><th>Nombre</th></tr></thead>
      <tbody id="tbodyH"></tbody>
    </table>
    <div class="note" id="noteH"></div>
  </section>

  <div class="footer-nav">
    <a class="back-button" href="index.html">Volver a Reservar</a>
  </div>
</div>

<script>
// Reemplaza por TU URL /exec del Web App de Apps Script
const BASE_URL = 'https://script.google.com/macros/s/XXXXXXXXXXXX/exec';

// Fallback local en GitHub Pages (pondrás data/rankings.json en el repo)
const FALLBACK_JSON_URL = './data/rankings.json';

function setFecha(){
  document.getElementById('lastUpdatedDate').textContent =
    'Ranking al día: ' + new Date().toLocaleDateString('es-CL',{year:'numeric',month:'long',day:'numeric'});
}

async function fetchJSON(url){
  const res = await fetch(url, { cache: 'no-store' });
  if(!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
  return res.json();
}

function renderTabla(tbodyId, tableId, loadingId, lista){
  const tbody = document.getElementById(tbodyId);
  const table = document.getElementById(tableId);
  const loading = document.getElementById(loadingId);
  tbody.innerHTML = '';

  if(!Array.isArray(lista) || lista.length === 0){
    loading.textContent = 'No hay datos en esta sección.';
    table.style.display = 'none';
    return;
  }

  for(const p of lista){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${p.posicion ?? ''}</td><td>${p.nombre ?? ''}</td>`;
    tbody.appendChild(tr);
  }
  loading.style.display = 'none';
  table.style.display = '';
}

function pintarFuentes(noteId, fuente){
  const note = document.getElementById(noteId);
  note.textContent = `Fuente: ${fuente}`;
}

async function cargar(){
  setFecha();
  const urlExec = BASE_URL; // combinado (mujeres/hombres)

  try{
    // 1) Intento vía Apps Script combinado
    const data = await fetchJSON(urlExec);
    // Se espera { mujeres: [...], hombres: [...] }
    if(!data.mujeres || !data.hombres) throw new Error('JSON inesperado del Web App');

    renderTabla('tbodyM','tableM','loadingM', data.mujeres);
    renderTabla('tbodyH','tableH','loadingH', data.hombres);
    pintarFuentes('noteM', urlExec + '  (mujeres/hombres)');
    pintarFuentes('noteH', urlExec + '  (mujeres/hombres)');
  }catch(err1){
    console.warn('Fallo Web App, usando fallback local:', err1);
    try{
      // 2) Fallback a archivo estático en GitHub
      const dataFallback = await fetchJSON(FALLBACK_JSON_URL);
      renderTabla('tbodyM','tableM','loadingM', dataFallback.mujeres || []);
      renderTabla('tbodyH','tableH','loadingH', dataFallback.hombres || []);
      pintarFuentes('noteM', FALLBACK_JSON_URL);
      pintarFuentes('noteH', FALLBACK_JSON_URL);
    }catch(err2){
      console.error('También falló el fallback local:', err2);
      // Mensajes de error visibles
      document.getElementById('loadingM').textContent = 'Error cargando datos. Revisa el Web App y el JSON local.';
      document.getElementById('loadingH').textContent = 'Error cargando datos. Revisa el Web App y el JSON local.';
      document.getElementById('tableM').style.display = 'none';
      document.getElementById('tableH').style.display = 'none';
    }
  }
}

document.addEventListener('DOMContentLoaded', cargar);
</script>
</body>
</html>
